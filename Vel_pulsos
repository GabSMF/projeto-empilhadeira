// ===== teste mínimo de leitura de encoder =====
#define ENCODER_PIN 3

volatile unsigned long encoder = 0;  // contador de pulsos (atualizado na ISR)
unsigned long lastPrint = 0;
unsigned long lastCount = 0;

void incrementa_encoder() {
  encoder++;  // incrementa a cada borda de subida
}

void setup() {
  Serial.begin(115200);            // abra o Serial Monitor/Plotter em 115200
  pinMode(ENCODER_PIN, INPUT_PULLUP); // use INPUT se já houver pull-up no sensor
  attachInterrupt(digitalPinToInterrupt(ENCODER_PIN), incrementa_encoder, RISING);
}

void loop() {
  // imprime a cada 200 ms
  unsigned long now = millis();
  if (now - lastPrint >= 200) {
    noInterrupts();
    unsigned long count = encoder;      // leitura atômica
    interrupts();

    unsigned long delta = count - lastCount;
    lastCount = count;
    lastPrint = now;

    // duas infos úteis: total acumulado e pulsos no último intervalo
    Serial.print("total: ");
    Serial.print(count);
    Serial.print("   delta_200ms: ");
    Serial.println(delta);
  }
}
